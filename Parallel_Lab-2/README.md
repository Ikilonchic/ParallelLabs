# Отчёт по лабораторной работе №2

по дисциплине "Параллельные и распредлённые вычисления"
студента группы ПА-18-2
Куца Никиты Юрьевича

## Постановка задачи

* Установите MPICH (MPI Chameleon) крайней версии;  
* Выучить правила вызова утилиты mpiexec;  
* Скомпилировать и запустить тестовую программу с разным количеством
  процессов на одном персональном компьютере.
  
## Выполнение

### Установка на Linux

На Ubuntu/Debian и системах на их основе библиотека MPI устанавливается с помощью пакетного менеджера ``apt``:

``sudo apt install mpich``

После которой можно проверить установку, запустив команду ``mpiexec --help``. В случае, если консоль не видит команду, стоит проверить внесена ли команда в переменные среды Linux:

![mpiexec --help][mpiexec-example]

[mpiexec-example]: img/mpiexec-example.png

### Установка на Windows

Установить MPI от Microsoft можно по [этой ссылке][mpi-link]. Скачиваем
и запускаем одну из двух предложенных программ. После открываем терминал и вводим команду ``mpiexec``.
Если видим такой же результат, какой указан на скриншоте ниже, то всё готово,
иначе следует добавить путь к ``mpiexec.exe`` в переменные среды Windows.

[mpi-link]: https://www.microsoft.com/en-us/download/details.aspx?id=57467

### Приложение

Для написания простого приложения на языке С, которая будет выводить общее количество запищенных процессов и их номера (ранги), будеим использовать следующие команды из библиотеки MPI:

* ``MPI_Init`` - инициалзация библиотеки MPI;
* ``MPI_Comm_rank`` - получает ранг (номер) текущего процесса;
* ``MPI_Comm_size`` - получает общее количество процессов;
* ``MPI_Finalize`` - заввершение программы MPI;

Приложение будет иметь следующий вид:

```C
#include <stdlib.h>
#include <stdio.h>

#include "mpi.h"

int main(int argc, char** argv) {
    MPI_Init(&argc, &argv);

    int* commRank = (int*)malloc(sizeof(int));
    int* commSize = (int*)malloc(sizeof(int));

    MPI_Comm_rank(MPI_COMM_WORLD, commRank);
    MPI_Comm_size(MPI_COMM_WORLD, commSize);

    fprintf(stdout, "%s: %i\n%s: %i\n", "Comm rank", *commRank, "Comm size", *commSize);

    free(commRank);
    free(commSize);
    MPI_Finalize();

    return EXIT_SUCCESS;
}
```

Благодаря CMake - это кроссплатформенная система автоматизации сборки программного обеспечения - приложение без проблем можно запустить на любой поддерживаемой системе.

## Анализ результатов

Компилируем программу и запускаем ее с помощью команды `mpiexec`. Для указания количества запущенных процессов вводим флаг `-n` командной строки с численным параметром от 0 до допустимого количества:

![Linux example][linux-example]

Запуск программ начиная с этой лабораторной работы произоводился на Linux, т.к. на Windows возникли технические проблемы с библиотекой MPI.

[linux-example]: img/linux-example.png
